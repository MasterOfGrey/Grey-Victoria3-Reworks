# We are using this to identify when a country can afford to give away 30% of its convoy production.
REPLACE_OR_CREATE:excess_convoy_surplus_percent = {
	add = {
		add = num_convoys_required
		min = 1
	}
	add = {
		add = modifier:country_convoy_contribution_to_market_owner_add
		multiply = num_convoys_available
	}
	divide = { 
		add = num_convoys_available	# If result is 0.7 or lower they will have enough to give away.
		min = 1
	}						# We have currently calculated **usage** as a %
	multiply = -1
	add = 1					# (1-usage)=[surplus as proportion of total] (which must be >0.3 to share)
	if = {					# We want to use 0 as a baseline so (surplus-pact requirement) if no pact
		limit = { 
			num_diplomatic_pacts = {	# Don't double count the pact requirement when the pact is active
				type = occ_offer_convoys
				value < 1
			}
		}
		add = -0.3				# If result >0, then has enough to give away.
	}
}

REPLACE_OR_CREATE:after_increase_contribution_percent = {
	add = modifier:country_convoy_contribution_to_market_owner_add
	add = 0.3
}

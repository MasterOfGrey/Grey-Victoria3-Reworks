TRY_REPLACE:add_power_bloc_culture = {
	groups= {
		power_bloc_leader
	}
	show_in_lens = no

	texture = "gfx/interface/icons/diplomatic_action_icons/force_culture.dds"

	selectable = {
		is_power_bloc_leader = yes
		power_bloc ?= {
			modifier:power_bloc_leader_can_spread_culture_to_pb_bool = yes
		}
	}

	potential = {
		power_bloc ?= {
			scope:target_country.power_bloc ?= this
		}
	}

	possible = {
		scope:target_country ?= {
			NOT = { any_primary_culture = { is_primary_culture_of = root } }
		}
		scope:target_country ?= {
			any_primary_culture = {
				OR = {
					shares_language_trait_group_with_any_primary_culture = ROOT
					shares_language_trait_with_any_primary_culture = ROOT
					AND = {
						shares_heritage_trait_group_with_any_primary_culture = ROOT		# Catch relevant potentials
						shares_tradition_trait_with_any_primary_culture = ROOT
					}
				}
			}
		}
		power_bloc = {
			current_cohesion_percentage >= 0.5
		}
		scope:target_country = {
			tenure_in_current_power_bloc_years >= 5
		}
		prestige >= {
			value = scope:target_country.prestige
			multiply = 3
		}
	}

	accept_effect = {
		if = {								# Overlord/PB Leader Scope
			limit = {											# Prioritise language matches first
				any_primary_culture = {
					OR = {
						shares_language_trait_group_with_any_primary_culture = scope:target_country
						shares_language_trait_with_any_primary_culture = scope:target_country
					}
				}
			}
			ordered_primary_culture = {
				limit = {											# Modded
					OR = {
						shares_language_trait_group_with_any_primary_culture = scope:target_country
						shares_language_trait_with_any_primary_culture = scope:target_country
					}
				}
				order_by = "root.culture_percent_country(this)"
				position = 0										# Modded
				save_scope_as = main_culture_scope
			}
		}
		else_if = {
			limit = {											# Tradition matches come 2nd, if at all.
				any_primary_culture = {
					shares_heritage_trait_group_with_any_primary_culture = scope:target_country		# Catch relevant potentials
					shares_tradition_trait_with_any_primary_culture = scope:target_country			# Intentionally AND
				}
			}
			ordered_primary_culture = {
				limit = {											# Modded
					shares_heritage_trait_group_with_any_primary_culture = scope:target_country		# Catch relevant potentials
					shares_tradition_trait_with_any_primary_culture = scope:target_country			# Intentionally AND
				}
				order_by = "root.culture_percent_country(this)"
				position = 0										# Modded
				save_scope_as = main_culture_scope
			}
		}
		scope:target_country = {			# Subject/PB Member Scope
			ordered_primary_culture = {							# Modded
				limit = {
					OR = {
						shares_language_trait_group_with_any_primary_culture = ROOT
						shares_language_trait_with_any_primary_culture = ROOT
					}
				}
				order_by = "scope:target_country.culture_percent_country(this)"
				position = 0
				save_scope_as = similar_culture_scope
			}
			add_primary_culture = scope:main_culture_scope
			every_scope_state = {								# Modded
				custom_tooltip = {
					text = change_portion_of_pop_culture_pb_tt
					every_scope_pop = {
						limit = {
							OR = {
								has_pop_culture = scope:similar_culture_scope							# Efficiencies for the biggest pop type
								culture = {
									OR = {
										shares_language_trait_with_any_primary_culture = ROOT
										shares_language_trait_group_with_any_primary_culture = ROOT
										AND = {															# Catch relevant extras
											shares_heritage_trait_group_with_any_primary_culture = ROOT
											shares_tradition_trait_with_any_primary_culture = ROOT
										}
									}
								}
							}
						}
						change_pop_culture = {
							target = scope:main_culture_scope
							value = 0.05
						}
					}
				}
			}
		}

		power_bloc = {
			add_cohesion_percent = scaled_cohesion_cost
		}
	}

	ai = {
		evaluation_chance = {
			value = 0.025 # AI shouldn't use this very often
		}

		will_propose = {
			power_bloc = { current_cohesion_percentage >= 0.75 }
		}

		propose_score = {
			value = 10
		}
	}
}

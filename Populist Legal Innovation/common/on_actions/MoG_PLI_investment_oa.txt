# Setup
on_game_started_after_lobby = {
	on_actions = {
		mog_pli_investment_var_setup_oa
	}
}

mog_pli_investment_var_setup_oa = {
	effect = {
		#set/initialize country/journal relevant variables
		if = {
			limit = {
				pli_corruption_tracking_trigger = no
			}
			set_global_variable = mog_pli_corruption_disabled	# This is used for Loc
		}
	}
}

# Impacts on Investor Confidence
on_diplomatic_play_started = {
	on_actions = {
		mog_pli_war_confidence
	}
}

on_harvest_condition_started_in_country = {
	on_actions = {
		mog_pli_hc_confidence
	}
}

mog_pli_war_confidence = {
	effect = {
		scope:initiator = {
			je:je_mog_pli_investment = {
				set_bar_progress = {
					value = {
						add = var:mog_pli_investment_current_value
						add = {
							add = -10
							multiply = {
								add = scope:target.army_power_projection
								divide = scope:initiator.army_power_projection
							}
						}
						min = 0
					}
					name = mog_pli_investment_tracking_bar
				}
			}
			set_variable = {	# Reset progress level variable after changing progress bar.
				name = mog_pli_investment_current_value
				value = "je:je_mog_pli_investment.scripted_bar_progress(mog_pli_investment_tracking_bar)"
			}
		}
	}
}

mog_pli_hc_confidence = {
	effect = {	# Root = country
		if = {
			limit = {
				scope:state.state_region = { harvest_condition_good = yes}
			}
			je:je_mog_pli_investment = {
				set_bar_progress = {
					value = {
						add = var:mog_pli_investment_current_value
						add = {
							add = 5
							multiply = {
								add = scope:intensity
							}
						}
						max = 100
					}
					name = mog_pli_investment_tracking_bar
				}
			}
			set_variable = {	# Reset progress level variable after changing progress bar.
				name = mog_pli_investment_current_value
				value = "je:je_mog_pli_investment.scripted_bar_progress(mog_pli_investment_tracking_bar)"
			}
		}
		else = {
			je:je_mog_pli_investment = {
				set_bar_progress = {
					value = {
						add = var:mog_pli_investment_current_value
						add = {
							add = -5
							multiply = {
								add = scope:intensity
							}
						}
						min = 0
					}
					name = mog_pli_investment_tracking_bar
				}
			}
			set_variable = {	# Reset progress level variable after changing progress bar.
				name = mog_pli_investment_current_value
				value = "je:je_mog_pli_investment.scripted_bar_progress(mog_pli_investment_tracking_bar)"
			}
		}
	}
}

# Responsiveness effects
on_monthly_pulse_country = {
	on_actions = {
		mog_pli_falling_standards_response
	}
}

mog_pli_falling_standards_response = {
	effect = {
		if = {
			limit = { has_variable = mog_pli_investment_current_value }
			if = {
				limit = {
					var:mog_pli_investment_current_value > mog_pli_investment_target	# Conditions are degrading
				}
				add_modifier = {
					name = je_mog_pli_liberal_reaction
					years = 10
					multiplier = je_mog_pli_liberal_reaction_multiplier
					is_decaying = yes
				}
			}
		}
	}
}
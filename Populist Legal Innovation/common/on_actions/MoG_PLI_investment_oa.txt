# Setup
on_game_started_after_lobby = {
	on_actions = {
		mog_pli_investment_var_setup_oa
	}
}

mog_pli_investment_var_setup_oa = {
	effect = {
		#set/initialize country/journal relevant variables
		if = {
			limit = {
				pli_corruption_tracking_trigger = no
			}
			set_global_variable = mog_pli_corruption_disabled	# This is used for Loc
		}
	}
}

# Impacts on Investor Confidence
on_diplomatic_play_started = {
	on_actions = {
		mog_pli_war_confidence
	}
}

on_harvest_condition_started_in_country = {
	on_actions = {
		mog_pli_hc_confidence
	}
}

mog_pli_war_confidence = {
	effect = {
		set_local_variable = {
			name = target_var
			value = scope:target.army_power_projection
		}
		set_local_variable = {
			name = initiator_var
			value = scope:initiator.army_power_projection
		}
		scope:initiator = {
			set_local_variable = {
				name = je_var
				value = var:mog_pli_investment_current_value
			}
			# debug_log = "PLI-varcheck: [SCOPE.GetLocalVariable('je_var').GetValue]"
			je:je_mog_pli_investment = {
				set_bar_progress = {
					value = mog_pli_war_confidence_hit_val
					name = mog_pli_investment_tracking_bar
				}
			}
			set_variable = {	# Reset progress level variable after changing progress bar.
				name = mog_pli_investment_current_value
				value = "je:je_mog_pli_investment.scripted_bar_progress(mog_pli_investment_tracking_bar)"
			}
		}
		scope:target = {
			set_local_variable = {
				name = je_var
				value = var:mog_pli_investment_current_value
			}
			# debug_log = "PLI-varcheck: [SCOPE.GetLocalVariable('je_var').GetValue]"
			je:je_mog_pli_investment = {
				set_bar_progress = {
					value = mog_pli_war_confidence_target_hit_val
					name = mog_pli_investment_tracking_bar
				}
			}
			set_variable = {	# Reset progress level variable after changing progress bar.
				name = mog_pli_investment_current_value
				value = "je:je_mog_pli_investment.scripted_bar_progress(mog_pli_investment_tracking_bar)"
			}
		}
	}
}

mog_pli_hc_confidence = {
	effect = {	# Root = country
		set_local_variable = {
			name = je_var
			value = var:mog_pli_investment_current_value
		}
		if = {
			limit = {
				scope:state.state_region = { harvest_condition_good = yes}
			}
			je:je_mog_pli_investment = {
				set_bar_progress = {
					value = {
						add = local_var:je_var
						add = {
							add = 5
							multiply = {
								add = scope:intensity
							}
						}
						max = 100
					}
					name = mog_pli_investment_tracking_bar
				}
			}
			set_variable = {	# Reset progress level variable after changing progress bar.
				name = mog_pli_investment_current_value
				value = "je:je_mog_pli_investment.scripted_bar_progress(mog_pli_investment_tracking_bar)"
			}
		}
		else = {
			je:je_mog_pli_investment = {
				set_bar_progress = {
					value = {
						add = local_var:je_var
						add = {
							if = {
								limit = { morgenrote_is_active = yes }
								add = -3	# Bad events are more common with Morgenrote.
							}
							else = {
								add = -5
							}
							multiply = {
								add = scope:intensity
							}
						}
						min = 0
					}
					name = mog_pli_investment_tracking_bar
				}
			}
			set_variable = {	# Reset progress level variable after changing progress bar.
				name = mog_pli_investment_current_value
				value = "je:je_mog_pli_investment.scripted_bar_progress(mog_pli_investment_tracking_bar)"
			}
		}
	}
}

# Responsiveness effects
on_monthly_pulse_country = {
	on_actions = {
		mog_pli_falling_standards_response
	}
}

mog_pli_falling_standards_response = {
	effect = {
		if = {
			limit = { has_variable = mog_pli_investment_current_value }
			if = {
				limit = {
					var:mog_pli_investment_current_value > mog_pli_investment_target	# Conditions are degrading
					mog_pli_investment_target < 95
					var:mog_pli_investment_current_value < mog_pli_max_investment_willingness_from_ip
				}
				add_modifier = {
					name = je_mog_pli_liberal_reaction
					years = 10
					multiplier = je_mog_pli_reaction_multiplier
					is_decaying = yes
				}
			}
			else_if = {
				limit = {
					var:mog_pli_investment_current_value > mog_pli_max_investment_willingness_from_ip	# Conditions are overheated AND degrading
					mog_pli_investment_target < 85
				}
				add_modifier = {
					name = je_mog_pli_redistributive_reaction
					years = 5
					multiplier = je_mog_pli_reaction_multiplier
					is_decaying = yes
				}
			}
		}
	}
}
# Country scope unless called specifically in JE Scope.
MoG_PLI_do_innovation_setup_effect = {
	set_local_variable = {
		name = mog_pli_innovation_bar_start_value
		value = mog_pli_innovation_target
	}
	je:je_mog_pli_innovation = {
		set_bar_progress = {
			value = local_var:mog_pli_innovation_bar_start_value
			name = mog_pli_innovation_tracking_bar
		}
	}
}

MoG_PLI_do_proliferation_setup_effect = {
	set_local_variable = {
		name = mog_pli_proliferation_bar_start_value
		value = mog_pli_proliferation_target
	}
	je:je_mog_pli_innovation = {
		set_bar_progress = {
			value = local_var:mog_pli_proliferation_bar_start_value
			name = mog_pli_proliferation_tracking_bar
		}
	}
}

MoG_PLI_do_innovation_stuff_effect = {
	# Do innovation modifier stuff
	if = { # Create variables if not set already
		limit = {
			NOT = {
				has_variable = mog_pli_innovation_current_prev
			}
		}
		set_variable = {
			name  = mog_pli_innovation_current_prev
			value = 0
		}
	}
	scope:journal_entry = {
		if = { 				# Remove outdated modifier.
			limit = { has_modifier = je_mog_pli_innovation_modifier }
			remove_modifier = je_mog_pli_innovation_modifier
		}
		add_modifier = {	# Add updated modifier.
			name = je_mog_pli_innovation_modifier
			multiplier = mog_pli_innovation_multiplier		# Inverse of the innovation % from the JE.
		}
	}
	
	# Do proliferation modifier stuff
	if = { # Create variables if not set already
		limit = {
			NOT = {
				has_variable = mog_pli_proliferation_current_prev
			}
		}
		set_variable = {
			name  = mog_pli_proliferation_current_prev
			value = 0
		}
	}
	scope:journal_entry = {
		if = { 				# Remove outdated modifier.
			limit = { has_modifier = je_mog_pli_proliferation_modifier }
			remove_modifier = je_mog_pli_proliferation_modifier
		}
		add_modifier = {	# Add updated modifier.
			name = je_mog_pli_proliferation_modifier
			multiplier = mog_pli_proliferation_multiplier
		}
	}
	
	set_variable = {									# At the end of the process, set the current target as the previous to use for next time.
		name = mog_pli_innovation_current_prev			# Used in ??
		value = var:mog_pli_innovation_current_value	# Note: number value between 0-100 & represents ??
	}
}

# scope = country
pli_innovation_citizenship_percent_cache_update = {
	save_temporary_scope_as = country
	# Initialize pop counters
	set_variable = {
		name = pli_pop_total
		value = 0
	}
	set_variable = {
		name = pli_pop_citizens
		value = 0
	}
	# Count the pops
	every_scope_state = {
		if = {
			limit = { is_incorporated = yes }
			every_scope_pop = {
				change_variable = {
					name = pli_pop_total
					add = total_size
				}
				if = {
					limit = {
						pop_acceptance >= acceptance_status_4
					}
					change_variable = {
						name = pli_pop_citizens
						add = total_size
					}
				}
			}
		}
	}
	# Save the percents
	scope:country = {
		save_temporary_scope_value_as = {
			name = pli_innovation_limit
			value = {
				value = var:pli_pop_citizens
				divide = {
					value = var:pli_pop_total
					min = 1
				}
			}
		}
		set_variable = {
			name = pli_innovation_citizenship_percent
			value = scope:pli_innovation_limit
		}
	}
	# Cleanup working variables
	remove_variable = pli_pop_total
	remove_variable = pli_pop_citizens
}


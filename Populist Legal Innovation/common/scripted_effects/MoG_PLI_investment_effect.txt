# Country scope or JE Scope?
MoG_PLI_do_investment_stuff_effect = {
	if = { # Create variables if not set already
		limit = {
			NOT = {
				has_variable = mog_pli_investment_current_prev
			}
		}
		MoG_PLI_set_investment_variables_effect = yes
	}
	
	## Different pop types have different absolute contribution amounts, so each one needs their own calculation (unfortunately).
	## These are ordered from highest wage multiplier to lowest wage multiplier, and alphabetical within that, just to have some sort of ordering...
	# Calculate adjustment for ARISTOCRAT investment contributions
	set_variable = {
		name = mog_pli_aristo_contribution_adjustment	# This a positive number that represents the magnitude of the negative adjustment modifier.
		value = {										# Contributions are 0-1 so remember we're ultimately getting a % portion of a "percent" value.
			add = {														# Calculate what the default modifier value would be right now - 
				add = mog_pli_aristo_contribution_base_sv					# - i.e. the total unadjusted modifier based on previous month.
				add = {													# Account for if base sources of the modifier have changed since previously.
					add = modifier:state_aristocrats_investment_pool_contribution_add
					subtract = {
						add = mog_pli_aristo_contribution_base_sv				# base - adjustment = actual modifier value
						subtract = var:mog_pli_aristo_contribution_adjustment	# if sources have increased -> result +ve, else -ve if decreased
					}															# -> tracks underlying changes correctly and adapts to them
				}
			}
			multiply = {								# ^So now that we have the current base value from above, multiply by investment % from the JE.
				value = {
					add = 100											# investment_current_value is actually the limiting proportion
					subtract = var:mog_pli_investment_current_value		# 100-current gets the proportion for the negative penalty
					divide = 100										# Convert to %
				}
			}
		}												# Now we have the actual magnitude of the negative modifier to be additively applied.
	}
	if = { 				# Remove outdated modifier.
		limit = { has_modifier = je_mog_pli_aristo_investment_modifier }
		remove_modifier = je_mog_pli_aristo_investment_modifier
	}
	add_modifier = {	# Add updated modifier.
		name = je_mog_pli_aristo_investment_modifier				# (default value: state_aristocrats_investment_pool_contribution_add = -1 )
		multiplier = var:mog_pli_aristo_contribution_adjustment		# some value between 0 & the unadjusted pop investment contribution modifier value
	}
	
	# Calculate adjustment for CAPITALIST investment contributions
	set_variable = {
		name = mog_pli_capis_contribution_adjustment
		value = {
			add = {
				add = mog_pli_capis_contribution_base_sv
				add = {
					add = modifier:state_capitalists_investment_pool_contribution_add
					subtract = {
						add = mog_pli_capis_contribution_base_sv
						subtract = var:mog_pli_capis_contribution_adjustment
					}
				}
			}
			multiply = {
				value = {
					add = 100
					subtract = var:mog_pli_investment_current_value
					divide = 100
				}
			}
		}
	}
	if = { 				# Remove outdated modifier.
		limit = { has_modifier = je_mog_pli_capis_investment_modifier }
		remove_modifier = je_mog_pli_capis_investment_modifier
	}
	add_modifier = {	# Add updated modifier.
		name = je_mog_pli_capis_investment_modifier
		multiplier = var:mog_pli_capis_contribution_adjustment
	}
	
	# Calculate adjustment for OFFICER investment contributions
	set_variable = {
		name = mog_pli_offis_contribution_adjustment
		value = {
			add = {
				add = mog_pli_offis_contribution_base_sv
				add = {
					add = modifier:state_officers_investment_pool_contribution_add
					subtract = {
						add = mog_pli_offis_contribution_base_sv
						subtract = var:mog_pli_offis_contribution_adjustment
					}
				}
			}
			multiply = {
				value = {
					add = 100
					subtract = var:mog_pli_investment_current_value
					divide = 100
				}
			}
		}
	}
	if = { 				# Remove outdated modifier.
		limit = { has_modifier = je_mog_pli_offis_investment_modifier }
		remove_modifier = je_mog_pli_offis_investment_modifier
	}
	add_modifier = {	# Add updated modifier.
		name = je_mog_pli_offis_investment_modifier
		multiplier = var:mog_pli_offis_contribution_adjustment
	}
	
	# Calculate adjustment for ACADEMIC investment contributions
	set_variable = {
		name = mog_pli_acads_contribution_adjustment
		value = {
			add = {
				add = mog_pli_acads_contribution_base_sv
				add = {
					add = modifier:state_academics_investment_pool_contribution_add
					subtract = {
						add = mog_pli_acads_contribution_base_sv
						subtract = var:mog_pli_acads_contribution_adjustment
					}
				}
			}
			multiply = {
				value = {
					add = 100
					subtract = var:mog_pli_investment_current_value
					divide = 100
				}
			}
		}
	}
	if = { 				# Remove outdated modifier.
		limit = { has_modifier = je_mog_pli_acads_investment_modifier }
		remove_modifier = je_mog_pli_acads_investment_modifier
	}
	add_modifier = {	# Add updated modifier.
		name = je_mog_pli_acads_investment_modifier
		multiplier = var:mog_pli_acads_contribution_adjustment
	}
	
	# Calculate adjustment for BUREAUCRAT investment contributions
	set_variable = {
		name = mog_pli_bcrats_contribution_adjustment
		value = {
			add = {
				add = mog_pli_bcrats_contribution_base_sv
				add = {
					add = modifier:state_bureaucrats_investment_pool_contribution_add
					subtract = {
						add = mog_pli_bcrats_contribution_base_sv
						subtract = var:mog_pli_bcrats_contribution_adjustment
					}
				}
			}
			multiply = {
				value = {
					add = 100
					subtract = var:mog_pli_investment_current_value
					divide = 100
				}
			}
		}
	}
	if = { 				# Remove outdated modifier.
		limit = { has_modifier = je_mog_pli_bcrats_investment_modifier }
		remove_modifier = je_mog_pli_bcrats_investment_modifier
	}
	add_modifier = {	# Add updated modifier.
		name = je_mog_pli_bcrats_investment_modifier
		multiplier = var:mog_pli_bcrats_contribution_adjustment
	}
	
	# Calculate adjustment for CLERGYMEN investment contributions
	set_variable = {
		name = mog_pli_clergy_contribution_adjustment
		value = {
			add = {
				add = mog_pli_clergy_contribution_base_sv
				add = {
					add = modifier:state_clergymen_investment_pool_contribution_add
					subtract = {
						add = mog_pli_clergy_contribution_base_sv
						subtract = var:mog_pli_clergy_contribution_adjustment
					}
				}
			}
			multiply = {
				value = {
					add = 100
					subtract = var:mog_pli_investment_current_value
					divide = 100
				}
			}
		}
	}
	if = { 				# Remove outdated modifier.
		limit = { has_modifier = je_mog_pli_clergy_investment_modifier }
		remove_modifier = je_mog_pli_clergy_investment_modifier
	}
	add_modifier = {	# Add updated modifier.
		name = je_mog_pli_clergy_investment_modifier
		multiplier = var:mog_pli_clergy_contribution_adjustment
	}
	
	# Calculate adjustment for ENGINEER investment contributions
	set_variable = {
		name = mog_pli_engies_contribution_adjustment
		value = {
			add = {
				add = mog_pli_engies_contribution_base_sv
				add = {
					add = modifier:state_engineers_investment_pool_contribution_add
					subtract = {
						add = mog_pli_engies_contribution_base_sv
						subtract = var:mog_pli_engies_contribution_adjustment
					}
				}
			}
			multiply = {
				value = {
					add = 100
					subtract = var:mog_pli_investment_current_value
					divide = 100
				}
			}
		}
	}
	if = { 				# Remove outdated modifier.
		limit = { has_modifier = je_mog_pli_engies_investment_modifier }
		remove_modifier = je_mog_pli_engies_investment_modifier
	}
	add_modifier = {	# Add updated modifier.
		name = je_mog_pli_engies_investment_modifier
		multiplier = var:mog_pli_engies_contribution_adjustment
	}
	
	# Calculate adjustment for SHOPKEEPER investment contributions
	set_variable = {
		name = mog_pli_shops_contribution_adjustment
		value = {
			add = {
				add = mog_pli_shops_contribution_base_sv
				add = {
					add = modifier:state_shopkeepers_investment_pool_contribution_add
					subtract = {
						add = mog_pli_shops_contribution_base_sv
						subtract = var:mog_pli_shops_contribution_adjustment
					}
				}
			}
			multiply = {
				value = {
					add = 100
					subtract = var:mog_pli_investment_current_value
					divide = 100
				}
			}
		}
	}
	if = { 				# Remove outdated modifier.
		limit = { has_modifier = je_mog_pli_shops_investment_modifier }
		remove_modifier = je_mog_pli_shops_investment_modifier
	}
	add_modifier = {	# Add updated modifier.
		name = je_mog_pli_shops_investment_modifier
		multiplier = var:mog_pli_shops_contribution_adjustment
	}
	
	# Calculate adjustment for FARMER investment contributions
	set_variable = {
		name = mog_pli_farms_contribution_adjustment
		value = {
			add = {
				add = mog_pli_farms_contribution_base_sv
				add = {
					add = modifier:state_farmers_investment_pool_contribution_add
					subtract = {
						add = mog_pli_farms_contribution_base_sv
						subtract = var:mog_pli_farms_contribution_adjustment
					}
				}
			}
			multiply = {
				value = {
					add = 100
					subtract = var:mog_pli_investment_current_value
					divide = 100
				}
			}
		}
	}
	if = { 				# Remove outdated modifier.
		limit = { has_modifier = je_mog_pli_farms_investment_modifier }
		remove_modifier = je_mog_pli_farms_investment_modifier
	}
	add_modifier = {	# Add updated modifier.
		name = je_mog_pli_farms_investment_modifier
		multiplier = var:mog_pli_farms_contribution_adjustment
	}
	
	# Calculate adjustment for CLERK investment contributions
	set_variable = {
		name = mog_pli_clerks_contribution_adjustment
		value = {
			add = {
				add = mog_pli_clerks_contribution_base_sv
				add = {
					add = modifier:state_clerks_investment_pool_contribution_add
					subtract = {
						add = mog_pli_clerks_contribution_base_sv
						subtract = var:mog_pli_clerks_contribution_adjustment
					}
				}
			}
			multiply = {
				value = {
					add = 100
					subtract = var:mog_pli_investment_current_value
					divide = 100
				}
			}
		}
	}
	if = { 				# Remove outdated modifier.
		limit = { has_modifier = je_mog_pli_clerks_investment_modifier }
		remove_modifier = je_mog_pli_clerks_investment_modifier
	}
	add_modifier = {	# Add updated modifier.
		name = je_mog_pli_clerks_investment_modifier
		multiplier = var:mog_pli_clerks_contribution_adjustment
	}
	
	# Calculate adjustment for MACHINIST investment contributions
	set_variable = {
		name = mog_pli_machs_contribution_adjustment
		value = {
			add = {
				add = mog_pli_machs_contribution_base_sv
				add = {
					add = modifier:state_machinists_investment_pool_contribution_add
					subtract = {
						add = mog_pli_machs_contribution_base_sv
						subtract = var:mog_pli_machs_contribution_adjustment
					}
				}
			}
			multiply = {
				value = {
					add = 100
					subtract = var:mog_pli_investment_current_value
					divide = 100
				}
			}
		}
	}
	if = { 				# Remove outdated modifier.
		limit = { has_modifier = je_mog_pli_machs_investment_modifier }
		remove_modifier = je_mog_pli_machs_investment_modifier
	}
	add_modifier = {	# Add updated modifier.
		name = je_mog_pli_machs_investment_modifier
		multiplier = var:mog_pli_machs_contribution_adjustment
	}
	
	# Calculate adjustment for SERVICEMEN/SOLDIER investment contributions
	set_variable = {
		name = mog_pli_soldies_contribution_adjustment
		value = {
			add = {
				add = mog_pli_soldies_contribution_base_sv
				add = {
					add = modifier:state_soldiers_investment_pool_contribution_add
					subtract = {
						add = mog_pli_soldies_contribution_base_sv
						subtract = var:mog_pli_soldies_contribution_adjustment
					}
				}
			}
			multiply = {
				value = {
					add = 100
					subtract = var:mog_pli_investment_current_value
					divide = 100
				}
			}
		}
	}
	if = { 				# Remove outdated modifier.
		limit = { has_modifier = je_mog_pli_soldies_investment_modifier }
		remove_modifier = je_mog_pli_soldies_investment_modifier
	}
	add_modifier = {	# Add updated modifier.
		name = je_mog_pli_soldies_investment_modifier
		multiplier = var:mog_pli_soldies_contribution_adjustment
	}
	
	# Calculate adjustment for LABORER investment contributions
	set_variable = {
		name = mog_pli_labs_contribution_adjustment
		value = {
			add = {
				add = mog_pli_labs_contribution_base_sv
				add = {
					add = modifier:state_laborers_investment_pool_contribution_add
					subtract = {
						add = mog_pli_labs_contribution_base_sv
						subtract = var:mog_pli_labs_contribution_adjustment
					}
				}
			}
			multiply = {
				value = {
					add = 100
					subtract = var:mog_pli_investment_current_value
					divide = 100
				}
			}
		}
	}
	if = { 				# Remove outdated modifier.
		limit = { has_modifier = je_mog_pli_labs_investment_modifier }
		remove_modifier = je_mog_pli_labs_investment_modifier
	}
	add_modifier = {	# Add updated modifier.
		name = je_mog_pli_labs_investment_modifier
		multiplier = var:mog_pli_labs_contribution_adjustment
	}
	
	set_variable = {									# At the end of the process, set the current target as the previous to use for next time.
		name = mog_pli_investment_current_prev			# Used in mog_pli_<pop>_contribution_base_sv
		value = var:mog_pli_investment_current_value	# Note: number value between 0-100 & represents limiting % multiplier (from JE)
	}
}

MoG_PLI_set_investment_variables_effect = { # Create variables if not set already
	if = {
		limit = {
			NOT = { has_variable = mog_pli_investment_current_prev }
		}
		set_variable = {
			name  = mog_pli_investment_current_prev
			value = 0
		}
	}
	if = {
		limit = { NOT = { has_variable = mog_pli_aristo_contribution_adjustment } }
		set_variable = {
			name  = mog_pli_aristo_contribution_adjustment
			value = 0
		}
	}
	if = {
		limit = { NOT = { has_variable = mog_pli_capis_contribution_adjustment } }
		set_variable = {
			name  = mog_pli_capis_contribution_adjustment
			value = 0
		}
	}
	if = {
		limit = { NOT = { has_variable = mog_pli_offis_contribution_adjustment } }
		set_variable = {
			name  = mog_pli_offis_contribution_adjustment
			value = 0
		}
	}
	if = {
		limit = { NOT = { has_variable = mog_pli_acads_contribution_adjustment } }
		set_variable = {
			name  = mog_pli_acads_contribution_adjustment
			value = 0
		}
	}
	if = {
		limit = { NOT = { has_variable = mog_pli_bcrats_contribution_adjustment } }
		set_variable = {
			name  = mog_pli_bcrats_contribution_adjustment
			value = 0
		}
	}
	if = {
		limit = { NOT = { has_variable = mog_pli_clergy_contribution_adjustment } }
		set_variable = {
			name  = mog_pli_clergy_contribution_adjustment
			value = 0
		}
	}
	if = {
		limit = { NOT = { has_variable = mog_pli_engies_contribution_adjustment } }
		set_variable = {
			name  = mog_pli_engies_contribution_adjustment
			value = 0
		}
	}
	if = {
		limit = { NOT = { has_variable = mog_pli_shops_contribution_adjustment } }
		set_variable = {
			name  = mog_pli_shops_contribution_adjustment
			value = 0
		}
	}
	if = {
		limit = { NOT = { has_variable = mog_pli_farms_contribution_adjustment } }
		set_variable = {
			name  = mog_pli_farms_contribution_adjustment
			value = 0
		}
	}
	if = {
		limit = { NOT = { has_variable = mog_pli_clerks_contribution_adjustment } }
		set_variable = {
			name  = mog_pli_clerks_contribution_adjustment
			value = 0
		}
	}
	if = {
		limit = { NOT = { has_variable = mog_pli_machs_contribution_adjustment } }
		set_variable = {
			name  = mog_pli_machs_contribution_adjustment
			value = 0
		}
	}
	if = {
		limit = { NOT = { has_variable = mog_pli_soldies_contribution_adjustment } }
		set_variable = {
			name  = mog_pli_soldies_contribution_adjustment
			value = 0
		}
	}
	if = {
		limit = { NOT = { has_variable = mog_pli_labs_contribution_adjustment } }
		set_variable = {
			name  = mog_pli_labs_contribution_adjustment
			value = 0
		}
	}
}
